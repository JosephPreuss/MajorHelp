<!DOCTYPE html>
<html lang="en">
{% include "navbar.html" %}
<head>
    <meta charset="UTF-8">
    <title>Department Search Results</title>

    <style>

        .filter-label {
            color: white;
            margin-right: 10px;
        }
        /* Container to center everything */
        .search-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 20px;
        }

        /* Search field container */
        #search-field-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            width: 100%;
            justify-content: center;
        }

        #search-query {
            padding: 10px;
            font-size: 16px;
            width: 300px;
            margin-right: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        /* Dropdown for search type */
        #filter-dropdown-container {
            display: flex;
            align-items: center;
            margin-left: 10px;
}

        .filter-dropdown select {
            padding: 10px;
            font-size: 16px;
            width: 300px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }

        /* Search button styling */
        button[type="submit"] {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            border-radius: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            box-sizing: border-box;
        }

        button[type="submit"]:hover {
            background-color: #45a049;
        }

        /* Filter section container (adjusted for centering) */
        #filters-container {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 20px;
            gap: 20px; /* Adds space between filter elements */
        }

        .filter-dropdown {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            width: 250px;
        }

        .filter-dropdown select {
            padding: 10px;
            font-size: 16px;
            width: 100%; /* Ensure select box takes full container width */
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            height: 40px;
        }

        /* Adjusting button appearance */
        .filter-button {
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            cursor: pointer;
        }

        .filter-button:hover {
            background-color: #45a049;
        }
    </style>

    <!-- Scripts -->
    <script>
        const departmentOptions = [
            'Humanities and Social Sciences',
            'Natural Sciences and Mathematics',
            'Business and Economics',
            'Education',
            'Engineering and Technology',
            'Health Sciences',
            'Arts and Design',
            'Agriculture and Environmental Studies',
            'Communication and Media',
            'Law and Criminal Justice'
        ];

        // Function to handle filter changes (department, major, etc.)
        function setActiveFilter(filter) {
            document.getElementById("filter").value = filter;

            const searchFieldContainer = document.getElementById("search-field-container");

            if (filter === 'department') {
                const select = document.createElement("select");
                select.name = "query";
                select.id = "search-query";

                // Add "Select a Department" as the default option
                select.innerHTML = `<option value="" disabled selected>Select a Department</option>` +
                    departmentOptions.map(option => `<option value="${option}">${option}</option>`).join('');

                searchFieldContainer.innerHTML = ''; 
                searchFieldContainer.appendChild(select);
            } else {
                const input = document.createElement("input");
                input.type = "text";
                input.id = "search-query";
                input.name = "query";
                input.placeholder = `Enter ${filter} name...`;
                searchFieldContainer.innerHTML = ''; 
                searchFieldContainer.appendChild(input);
            }
        }

        window.onload = function () {
            const filter = "{{ filter_type }}" || "department"; // Default filter is department
            setActiveFilter(filter);
        };

        // This function will handle the form submission for the filters without page reload
        function applyFilters() {
            const schoolType = document.getElementById("school-type").value;
            const searchQuery = document.getElementById("search-query").value;
            const sortOrder = document.getElementById("sort-order").value;

            // Update the filter values dynamically in the form
            document.getElementById("school-type-hidden").value = schoolType;
            document.getElementById("search-query-hidden").value = searchQuery;
            document.getElementById("sort-order-hidden").value = sortOrder;

            // Submit the form to filter the results
            document.getElementById("filter-form").submit();
        }
    </script>

</head>
<body>

<!-- Search Again Section -->
<div class="search-container">
    <h2 class="filter-label">Search Again</h2>
    <form action="{% url 'MajorHelp:search' %}" method="get">
        <div id="search-field-container">
            <!-- Default input for Major search -->
            <input type="text" id="search-query" name="query" placeholder="Enter your search term..." value="{{ query }}">

            <!-- Search by dropdown -->
            <div id="filter-dropdown-container">
                <label for="filter-dropdown" class="filter-label">Search by:</label>
                <select id="filter-dropdown" name="filter-dropdown" onchange="setActiveFilter(this.value)">
                    <option value="department" {% if filter_type == 'department' %}selected{% endif %}>Department</option>
                    <option value="school" {% if filter_type == 'school' %}selected{% endif %}>School</option>
                    <option value="major" {% if filter_type == 'major' %}selected{% endif %}>Major</option>
                </select>
            </div>
        </div>
        <button type="submit">Search</button>
    </form>
</div>

<!-- Filter Section (Horizontal Layout) -->
<div id="filters-container">
    <!-- Filter Dropdown for School Type -->
    <div class="filter-dropdown">
        <label for="school-type" class="filter-label">School Type:</label>
        <select id="school-type" onchange="applyFilters()">
            <option value="both" {% if school_type == 'both' %}selected{% endif %}>Both</option>
            <option value="public" {% if school_type == 'public' %}selected{% endif %}>Public</option>
            <option value="private" {% if school_type == 'private' %}selected{% endif %}>Private</option>
        </select>
    </div>

    <!-- Filter Dropdown for Sorting -->
    <div class="filter-dropdown">
        <label for="sort-order" class="filter-label">Sort By:</label>
        <select id="sort-order" name="sort_order" onchange="applyFilters()">
            <option value="none" {% if request.GET.sort_order == 'none' %}selected{% endif %}>None</option>
            <option value="low_to_high" {% if request.GET.sort_order == 'low_to_high' %}selected{% endif %}>
                Tuition (Low to High)
            </option>
            <option value="high_to_low" {% if request.GET.sort_order == 'high_to_low' %}selected{% endif %}>
                Tuition (High to Low)
            </option>
        </select>
    </div>
</div>

<!-- Filter Form (hidden, submits without redirecting) -->
<form id="filter-form" method="get" action="{% url 'MajorHelp:department_results' query=query %}" style="display: none;">
    <input type="hidden" id="filter-hidden" name="filter" value="{{ filter_type }}">
    <input type="hidden" id="school-type-hidden" name="school_type" value="{{ school_type }}">
    <input type="hidden" id="search-query-hidden" name="query" value="{{ query }}">
    <input type="hidden" id="sort-order-hidden" name="sort_order" value="{{ request.GET.sort_order|default:'none' }}">
</form>

<!-- Search Results -->
<h2>Search Results for "{{ query }}"</h2>

{% if results %}
    {% for university, details in results.items %}
        <h3>
            <a href="{% url 'MajorHelp:university-detail' slug=university.slug %}">{{ university.name }}</a>
            | {{ details.location }} | {{ details.type }}
        </h3>

        {% for department, majors in details.departments.items %}
            <h4>{{ department }}</h4>
            <ul>
                {% for major in majors %}
                    <li>
                        <a href="{% url 'MajorHelp:major-detail' slug=major.slug %}">{{ major.major_name }}</a>
                        (In-State: ${{ major.in_state_min_tuition }} - ${{ major.in_state_max_tuition }},
                        Out-of-State: ${{ major.out_of_state_min_tuition }} - ${{ major.out_of_state_max_tuition }})
                    </li>
                {% endfor %}
            </ul>
        {% endfor %}
    {% endfor %}
{% else %}
    <p>No results found for "{{ query }}"</p>
{% endif %}

</body>
</html>
