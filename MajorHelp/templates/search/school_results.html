<!DOCTYPE html>
<html lang="en">
{% include "navbar.html" %}
<head>
    <meta charset="UTF-8">
    <title>University Search Results</title>
    <script>
        const departmentOptions = [
            'Humanities and Social Sciences',
            'Natural Sciences and Mathematics',
            'Business and Economics',
            'Education',
            'Engineering and Technology',
            'Health Sciences',
            'Arts and Design',
            'Agriculture and Environmental Studies',
            'Communication and Media',
            'Law and Criminal Justice'
        ];

        function setActiveFilter(filter) {
            document.getElementById("filter").value = filter;

            const searchFieldContainer = document.getElementById("search-field-container");

            if (filter === 'department') {
                const select = document.createElement("select");
                select.name = "query";
                select.id = "search-query";

                // Add default "Select a Department" option
                select.innerHTML = `<option value="" disabled selected>Select a Department</option>` +
                    departmentOptions.map(option => `<option value="${option}">${option}</option>`).join('');

                searchFieldContainer.innerHTML = ''; 
                searchFieldContainer.appendChild(select);
            } else {
                const input = document.createElement("input");
                input.type = "text";
                input.id = "search-query";
                input.name = "query";
                input.placeholder = `Enter ${filter} name...`;
                searchFieldContainer.innerHTML = ''; 
                searchFieldContainer.appendChild(input);
            }
        }

        window.onload = function () {
            const filter = "{{ filter_type }}" || "school";
            setActiveFilter(filter);
        };
    </script>
</head>
<body>

<!-- Search Again Section -->
<div>
    <h1 style="display: inline;">Search Again</h1>
    <form action="/search/" method="get" style="display: inline;">
        <div id="search-field-container" style="display: inline;">
            <input type="text" id="search-query" name="query" placeholder="Enter your search term..." value="{{ query }}">
        </div>
        <input type="hidden" id="filter" name="filter" value="school">
        <button type="submit">Search</button>
    </form>
</div>

<!-- Filter Buttons -->
<div>
    <div>
        <button type="button" id="department-button" onclick="setActiveFilter('department')">Department</button>
        <button type="button" id="school-button" onclick="setActiveFilter('school')">School</button>
        <button type="button" id="major-button" onclick="setActiveFilter('major')">Major</button>
    </div>
</div>

<!-- Search Results -->
<h2>Search Results for "{{ query }}"</h2>
{% if results %}
    {% for university, details in results.items %}
        <h3>
            <a href="{% url 'MajorHelp:university-detail' slug=university.slug %}">
                {{ university.name }}
            </a>
            | {{ details.location }} | {{ details.type }}
        </h3>

        {% if filter_type == 'department' %}
            <!-- Display departments for department filter -->
            {% for department, majors in details.departments.items %}
                <h4>{{ department }}</h4>
            {% endfor %}
        {% else %}
            <!-- Display majors for school or major filter -->
            {% for department, majors in details.departments.items %}
                <h4>{{ department }}</h4>
                <ul>
                    {% for major in majors %}
                        <li>
                            <a href="{% url 'MajorHelp:major-detail' slug=major.slug %}">{{ major.major_name }}</a>
                            (In-State: ${{ major.in_state_min_tuition }} - ${{ major.in_state_max_tuition }},
                            Out-of-State: ${{ major.out_of_state_min_tuition }} - ${{ major.out_of_state_max_tuition }})
                        </li>
                    {% endfor %}
                </ul>
            {% endfor %}
        {% endif %}
    {% endfor %}
{% else %}
    <p>No results found for your search.</p>
{% endif %}

</body>
</html>
